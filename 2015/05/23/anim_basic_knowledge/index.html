<!DOCTYPE html><html lang="zh-Hans"><head><meta http-equiv="content-type" content="text/html; charset=utf-8"><meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport"><meta content="yes" name="apple-mobile-web-app-capable"><meta content="black-translucent" name="apple-mobile-web-app-status-bar-style"><meta content="telephone=no" name="format-detection"><meta name="description"><title>Android 动画基础 | lightSky'Blog</title><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/normalize/4.2.0/normalize.min.css"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/pure/0.6.0/pure-min.css"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/pure/0.6.0/grids-responsive-min.css"><link rel="stylesheet" type="text/css" href="/css/style.css?v=0.0.0"><link rel="stylesheet" href="//cdn.bootcss.com/font-awesome/4.6.3/css/font-awesome.min.css"><script type="text/javascript" src="//cdn.bootcss.com/jquery/3.0.0/jquery.min.js"></script><link rel="Shortcut Icon" type="image/x-icon" href="/favicon.ico"><link rel="apple-touch-icon" href="/apple-touch-icon.png"><link rel="apple-touch-icon-precomposed" href="/apple-touch-icon.png"><link rel="alternate" type="application/atom+xml" href="/atom.xml"></head><body><div class="body_container"><div id="header"><div class="site-name"><h1 class="hidden">Android 动画基础</h1><a id="logo" href="/.">lightSky'Blog</a><p class="description"></p></div><div id="nav-menu"><a href="/." class="current"><i class="fa fa-home"> Start</i></a><a href="/archives/"><i class="fa fa-archive"> Archiv</i></a><a href="/about/"><i class="fa fa-user"> Über</i></a><a href="/atom.xml"><i class="fa fa-rss"> RSS</i></a></div></div><div id="layout" class="pure-g"><div class="pure-u-1 pure-u-md-3-4"><div class="content_container"><div class="post"><h1 class="post-title">Android 动画基础</h1><div class="post-meta">May 23, 2015<span> | </span><span class="category"><a href="/categories/Android/">Android</a><a href="/categories/Android/Android动画/">Android动画</a></span><script src="https://dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js" async></script><span id="busuanzi_container_page_pv"> | <span id="busuanzi_value_page_pv"></span><span> Hits</span></span></div><a data-thread-key="2015/05/23/anim_basic_knowledge/" href="/2015/05/23/anim_basic_knowledge/#comments" class="ds-thread-count"></a><div class="post-content"><blockquote>
<p>本文为 <a href="https://github.com/android-cn/android-open-project-analysis" target="_blank" rel="external">Android 开源项目源码解析</a> 公共技术点中的 动画基础知识 部分,主要介绍了Andorid中的Anim动画和Property动画的基础知识，对于Property动画部分，之前有一篇文章详细介绍了整个Property的架构，源码分析，这里主要将其中的一些基础以及总结性知识进行整理和提炼，更详细的分析可以参考我的另一篇文章<a href="http://blog.csdn.net/xushuaic/article/details/40424379" target="_blank" rel="external">Property Anim详解</a>。  </p>
</blockquote>
<a id="more"></a>
<h2 id=""><a href="#" class="headerlink" title=" "></a> </h2><p>#一  传统View动画(Tween/Frame)</p>
<h2 id="1-1-Tween动画"><a href="#1-1-Tween动画" class="headerlink" title="1.1 Tween动画"></a>1.1 Tween动画</h2><p>主要有4中：缩放、平移、渐变、旋转</p>
<p><img src="/img/anim_basic_knowledge/tweenhirachy.png" alt="tween相关类继承关系">  </p>
<p>文件位置: res/anim/filename.xml<br>编译资源的数据类型：an Animation<br>资源引用：<br>Java: R.anim.filename<br>XML: @[package:]anim/filename  </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div></pre></td><td class="code"><pre><div class="line">&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt;  </div><div class="line">&lt;set xmlns:android=&quot;http://schemas.android.com/apk/res/android&quot;  </div><div class="line">android:interpolator=&quot;@[package:]anim/interpolator_resource&quot;  </div><div class="line">android:shareInterpolator=[&quot;true&quot; | &quot;false&quot;] &gt;  </div><div class="line">&lt;alpha  </div><div class="line">android:fromAlpha=&quot;float&quot;  </div><div class="line">android:toAlpha=&quot;float&quot; /&gt;  </div><div class="line">&lt;scale  </div><div class="line">android:fromXScale=&quot;float&quot;  </div><div class="line">android:toXScale=&quot;float&quot;  </div><div class="line">android:fromYScale=&quot;float&quot;  </div><div class="line">android:toYScale=&quot;float&quot;  </div><div class="line">android:pivotX=&quot;float&quot;  </div><div class="line">android:pivotY=&quot;float&quot; /&gt;  </div><div class="line">&lt;translate  </div><div class="line">android:fromXDelta=&quot;float&quot;  </div><div class="line">android:toXDelta=&quot;float&quot;  </div><div class="line">android:fromYDelta=&quot;float&quot;  </div><div class="line">android:toYDelta=&quot;float&quot; /&gt;  </div><div class="line">&lt;rotate  </div><div class="line">android:fromDegrees=&quot;float&quot;  </div><div class="line">android:toDegrees=&quot;float&quot;  </div><div class="line">android:pivotX=&quot;float&quot;  </div><div class="line">android:pivotY=&quot;float&quot; /&gt;  </div><div class="line">&lt;set&gt;  </div><div class="line">...  </div><div class="line">&lt;/set&gt;  </div><div class="line">&lt;/set&gt;</div></pre></td></tr></table></figure>
<p>布局文件必须有一个独立的根元素，可以是 <code>&lt;alpha&gt;</code>,<code>&lt;scale&gt;</code>, <code>&lt;translate&gt;</code>, <code>&lt;rotate&gt;</code>, <code>&lt;set&gt;</code>（持有一组其它的动画元素，甚至可以是内嵌的set元素） 中的一个</p>
<h3 id="1-1-1-lt-set-gt"><a href="#1-1-1-lt-set-gt" class="headerlink" title="1.1.1 &lt;set&gt;"></a>1.1.1 <code>&lt;set&gt;</code></h3><p>一个持有其它动画元素的容器 <code>&lt;alpha&gt;</code>, <code>&lt;scale&gt;</code>, <code>&lt;translate&gt;</code>,<code>&lt;rotate&gt;</code>或者其它 <code>&lt;set&gt;</code> 元素</p>
<p>属性<br><code>android:interpolator</code><br>应用于动画的插值器。该值必须是一个指定了插值器资源的引用（不是一个插值器的类名），在平台中有缺省的插值器资源可以使用，或者你可以创建自己的插值器资源，可以看下面关于插值器的讨论。<br>android:shareInterpolator<br>Boolean值， true：代表在所有的子元素中共享同一个插值器</p>
<h3 id="1-1-2-lt-alpha-gt"><a href="#1-1-2-lt-alpha-gt" class="headerlink" title="1.1.2 &lt;alpha&gt;"></a>1.1.2 <code>&lt;alpha&gt;</code></h3><blockquote>
<p>A fade-in or fade-out animation. Represents an AlphaAnimation.<br>一个渐入渐出的动画，对应的java类为AlphaAnimation。</p>
</blockquote>
<p>属性<br>android:fromAlpha<br>android:toAlpha<br>代表动画开始和结束时透明度，0.0表示完全透明，1.0表示完全不透明，Float值</p>
<h3 id="1-1-3-lt-scale-gt"><a href="#1-1-3-lt-scale-gt" class="headerlink" title="1.1.3   &lt;scale&gt;"></a>1.1.3   <code>&lt;scale&gt;</code></h3><p>可以实现动态调控件尺寸的效果，通过设置pivotX和pivotY你可以指定image缩放的中心点，比如：如果这些值是0，则表示左上角，所有的缩放变化将沿着右下角的轨迹运动。对应的类为：ScaleAnimation<br>属性<br>android:fromXScale<br>android:toXScale<br>android:fromYScale<br>android:toYScale<br>Float值，为动画起始到结束时，X、Y坐标上的伸缩尺寸<br>0.0表示收缩到没有<br>1.0表示正常无伸缩  </p>
<p>android:pivotX<br>android:pivotY<br>代表缩放的中轴点X/Y坐标，浮点值<br>如果我们想表示中轴点为图像的中心，我们可以把两个属性值定义成0.5或者50%。</p>
<h3 id="1-1-4-lt-translate-gt"><a href="#1-1-4-lt-translate-gt" class="headerlink" title="1.1.4  &lt;translate&gt;"></a>1.1.4  <code>&lt;translate&gt;</code></h3><p>代表一个水平、垂直的位移。对应的类为TranslateAnimation.<br>属性<br>android:fromXDelta  属性代表起始X方向的位置<br>android:toXDelta<br>android:fromYDelta<br>android:toYDelta  </p>
<p>代表动画起始或者结束X / Y方向上的位置，Float或者百分比值<br>浮点数num%、num%p分别相对于自身或者父控件<br>如果以浮点数字表示，是一个绝对值，代表相对自身原始位置的像素值；<br>如果以num%表示，代表相对于自己的百分比，比如toXDelta定义为100%就表示在X方向上移动自己的1倍距离<br>如果以num%p表示，代表相对于父类组件的百分比。</p>
<h3 id="1-1-5-lt-rotate-gt"><a href="#1-1-5-lt-rotate-gt" class="headerlink" title="1.1.5  &lt;rotate&gt;"></a>1.1.5  <code>&lt;rotate&gt;</code></h3><p>是旋转动画，与之对应的Java类是RotateAnimation</p>
<p>属性<br>android:fromDegrees<br>android:toDegrees<br>代表起始和结束的角度，浮点值，单位：度</p>
<p>android:pivotX 属性代表旋转中心的X坐标值<br>android:pivotY 属性代表旋转中心的Y坐标值<br>Float值或者百分比<br>这两个属性也有三种表示方式，但是X轴都是相对方向都是Left，Y轴都是相对于Top<br>浮点数、num%、num%p；<br>数字方式代表相对于自身左边缘的像素值，<br>num%方式代表相对于自身左边缘或顶边缘的百分比，<br>num%p方式代表相对于父容器的左边缘或顶边缘的百分比  </p>
<p>属性<br>android:fromDegrees<br>android:toDegrees<br>开始和结束时的弧度位置，单位是度，Float值  </p>
<p>调用代码  </p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">ImageView image = (ImageView) findViewById(R.id.image);  </div><div class="line">Animation hyperspaceJump = AnimationUtils.loadAnimation(<span class="keyword">this</span>, R.anim.hyperspace_jump); </div><div class="line">image.startAnimation(hyperspaceJump);</div></pre></td></tr></table></figure>
<p>另外，在动画中，如果我们添加了android:fillAfter=”true”后，这个动画执行完之后保持最后的状态；android:duration=”integer”代表动画持续的时间，单位为毫秒。</p>
<h3 id="1-1-6-插值器"><a href="#1-1-6-插值器" class="headerlink" title="1.1.6 插值器"></a>1.1.6 插值器</h3><p>用于修改一个动画过程中的速率，可以定义各种各样的非线性变化函数，比如加速、减速等<br>在Android中所有的插值器都是Interpolator 的子类，通过 android:interpolator   属性你可以引用不同的插值器。下面是几种插值器:    </p>
<p><img src="/img/anim_basic_knowledge/interpolators.png" alt="插值器"> </p>
<p>你可以通过下面的方式使用它们  </p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">set</span> <span class="attr">android:interpolator</span>=<span class="string">"@android:anim/accelerate_interpolator"</span>&gt;</span>  </div><div class="line">...  </div><div class="line"><span class="tag">&lt;/<span class="name">set</span>&gt;</span></div></pre></td></tr></table></figure>
<p><strong>自定义插值器</strong><br>如果你对系统提供的插值器不满意，我们可以创建一个插值器资源修改插值器的属性，比如修改AnticipateInterpolator的加速速率，调整CycleInterpolator的循环次数等。为了完成这种需求，我们需要创建XML资源文件，然后将其放于/res/anim下，然后再动画元素中引用即可。我们先来看一下几种常见的插值器可调整的属性：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt;  </div><div class="line">&lt;InterpolatorName xmlns:android=&quot;http://schemas.android.com/apk/res/android&quot;  </div><div class="line">android:attribute_name=&quot;value&quot;  </div><div class="line">/&gt;</div></pre></td></tr></table></figure></p>
<p>我们先来看一下几种常见的插值器可调整的属性：  </p>
<p><code>&lt;accelerateDecelerateInterpolator&gt;</code> 无  </p>
<p><code>&lt;accelerateInterpolator&gt;</code> android:factor 浮点值，加速速率，默认为1  </p>
<p><code>&lt;anticipateInterploator&gt;</code> android:tension 浮点值，起始点后退的张力、拉力数，默认为2  </p>
<p><code>&lt;anticipateOvershootInterpolator&gt;</code>  android:tension 同上 android:extraTension 浮点值，拉力的倍数，默认为1.5（2  * 1.5）  </p>
<p><code>&lt;bounceInterpolator&gt;</code> 无  </p>
<p><code>&lt;cycleInterplolator&gt;</code> android:cycles int，循环的个数，默认为1  </p>
<p><code>&lt;decelerateInterpolator&gt;</code> android:factor 浮点值，减速的速率，默认为1  </p>
<p><code>&lt;linearInterpolator&gt;</code> 无</p>
<p><code>&lt;overshootInterpolator&gt;</code>  浮点值，超出终点后的张力、拉力，默认为2  </p>
<p>比如：res/anim/my_overshoot_interpolator.xml:  </p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line">&lt;?xml version="1.0" encoding="utf-8"?&gt;  </div><div class="line"><span class="tag">&lt;<span class="name">overshootInterpolator</span> <span class="attr">xmlns:android</span>=<span class="string">"http://schemas.android.com/apk/res/android"</span>  </span></div><div class="line"><span class="attr">android:tension</span>=<span class="string">"7.0"</span>/&gt;  </div><div class="line">This animation XML will apply the interpolator:  </div><div class="line"><span class="tag">&lt;<span class="name">scale</span> <span class="attr">xmlns:android</span>=<span class="string">"http://schemas.android.com/apk/res/android"</span>  </span></div><div class="line"><span class="attr">android:interpolator</span>=<span class="string">"@anim/my_overshoot_interpolator"</span>  </div><div class="line"><span class="attr">android:fromXScale</span>=<span class="string">"1.0"</span>  </div><div class="line"><span class="attr">android:toXScale</span>=<span class="string">"3.0"</span>  </div><div class="line"><span class="attr">android:fromYScale</span>=<span class="string">"1.0"</span>  </div><div class="line"><span class="attr">android:toYScale</span>=<span class="string">"3.0"</span>  </div><div class="line"><span class="attr">android:pivotX</span>=<span class="string">"50%"</span>  </div><div class="line"><span class="attr">android:pivotY</span>=<span class="string">"50%"</span>  </div><div class="line"><span class="attr">android:duration</span>=<span class="string">"700"</span> /&gt;</div></pre></td></tr></table></figure>
<p>如果简单的修改插值器的属性值还不能够满足我们的需求，那么就自己来通过实现Interpolator接口来定义自己的插值器了<br>因为上面所有的Interpolator都实现了Interpolator接口，这个接口定义了一个方法：float getInterpolation(float input);<br>此方法由系统调用，input代表动画的时间，在0和1之间，也就是开始和结束之间。  </p>
<p>线性（匀速）插值器定义如下：<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">float</span> <span class="title">getInterpolation</span><span class="params">(<span class="keyword">float</span> input)</span> </span>&#123;    </div><div class="line"><span class="keyword">return</span> input;    </div><div class="line">&#125;</div><div class="line">```    </div><div class="line">  </div><div class="line">加速减速插值器定义如下：  </div><div class="line">```<span class="function">java</span></div><div class="line"><span class="keyword">public</span> <span class="keyword">float</span> <span class="title">getInterpolation</span><span class="params">(<span class="keyword">float</span> input)</span> &#123;    </div><div class="line"><span class="keyword">return</span> (<span class="keyword">float</span>)(Math.cos((input + <span class="number">1</span>) * Math.PI) / <span class="number">2.0f</span>) + <span class="number">0.5f</span>;    </div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<h2 id="1-2-Frame动画"><a href="#1-2-Frame动画" class="headerlink" title="1.2 Frame动画"></a>1.2 Frame动画</h2><p>文件目录：res/drawable/filename.xml<br>编译资源数据类型 AnimationDrawable<br>资源引用：<br>Java: R.drawable.filename<br>XML: @[package:]drawable.filename  </p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">&lt;?xml version="1.0" encoding="utf-8"?&gt;  </div><div class="line"><span class="tag">&lt;<span class="name">animation-list</span> <span class="attr">xmlns:android</span>=<span class="string">"http://schemas.android.com/apk/res/android"</span>  </span></div><div class="line"><span class="attr">android:oneshot</span>=<span class="string">[</span>"<span class="attr">true</span>" | "<span class="attr">false</span>"] &gt;  </div><div class="line"><span class="tag">&lt;<span class="name">item</span>  </span></div><div class="line"><span class="attr">android:drawable</span>=<span class="string">"@[package:]drawable/drawable_resource_name"</span>  </div><div class="line"><span class="attr">android:duration</span>=<span class="string">"integer"</span> /&gt;  </div><div class="line"><span class="tag">&lt;/<span class="name">animation-list</span>&gt;</span></div></pre></td></tr></table></figure>
<h3 id="1-2-1-lt-animation-list-gt"><a href="#1-2-1-lt-animation-list-gt" class="headerlink" title="1.2.1 &lt;animation-list&gt;"></a>1.2.1 <code>&lt;animation-list&gt;</code></h3><p>必须作为根元素，包含一个或者多个根元素<br>属性：android:oneshot ：true：只执行一次动画，false：循环执行  </p>
<h3 id="1-2-2-lt-item-gt"><a href="#1-2-2-lt-item-gt" class="headerlink" title="1.2.2 &lt;item&gt;"></a>1.2.2 <code>&lt;item&gt;</code></h3><blockquote>
<p>A single frame of animation. Must be a child &gt;of a  <code>&lt;animation-list&gt;</code> element.<br>一帧独立动画，必须是<code>&lt;animation-list&gt; &gt;</code>的子元素  </p>
</blockquote>
<p>属性<br>android:drawable<br>Drawable资源，用于这一帧的图片<br>android:duration<br>Integer类型.该帧的时长，单位为毫秒milliseconds.  </p>
<p>res/anim/rocket.xml:    </p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">&lt;?xml version="1.0" encoding="utf-8"?&gt;  </div><div class="line"><span class="tag">&lt;<span class="name">animation-list</span> <span class="attr">xmlns:android</span>=<span class="string">"http://schemas.android.com/apk/res/android"</span>  </span></div><div class="line"><span class="attr">android:oneshot</span>=<span class="string">"false"</span>&gt;  </div><div class="line"><span class="tag">&lt;<span class="name">item</span> <span class="attr">android:drawable</span>=<span class="string">"@drawable/rocket_thrust1"</span> <span class="attr">android:duration</span>=<span class="string">"200"</span> /&gt;</span>  </div><div class="line"><span class="tag">&lt;<span class="name">item</span> <span class="attr">android:drawable</span>=<span class="string">"@drawable/rocket_thrust2"</span> <span class="attr">android:duration</span>=<span class="string">"200"</span> /&gt;</span>  </div><div class="line"><span class="tag">&lt;<span class="name">item</span> <span class="attr">android:drawable</span>=<span class="string">"@drawable/rocket_thrust3"</span> <span class="attr">android:duration</span>=<span class="string">"200"</span> /&gt;</span>  </div><div class="line"><span class="tag">&lt;/<span class="name">animation-list</span>&gt;</span></div></pre></td></tr></table></figure>
<p>调用代码  </p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">ImageView rocketImage = (ImageView) findViewById(R.id.rocket_image);  </div><div class="line">rocketImage.setBackgroundResource(R.drawable.rocket_thrust);  </div><div class="line">rocketAnimation = (AnimationDrawable) rocketImage.getBackground();  </div><div class="line">rocketAnimation.start();</div></pre></td></tr></table></figure>
<h2 id="-1"><a href="#-1" class="headerlink" title=" "></a> </h2><p>#二. Property Animation</p>
<p>##2.1 Property Animation的工作方式</p>
<p>Property Animation动画有两个步聚：<br>1.计算属性值<br>2.为目标对象的属性设置属性值，即应用和刷新动画  </p>
<p>###2.1.1 计算属性值</p>
<p><img src="/img/anim_basic_knowledge/valuecaculate.png" alt="属性值计算"></p>
<p><strong>过程一：计算已完成动画分数 elapsed fraction</strong><br>为了执行一个动画，你需要创建一个ValueAnimator，并且指定目标对象属性的开始、结束值和持续时间。在调用start后的整个动画过程中， ValueAnimator会根据已经完成的动画时间计算得到一个0到1之间的分数，代表该动画的已完成动画百分比。0表示0%，1表示100%。</p>
<p><strong>过程二：计算插值（动画变化率）interpolated fraction</strong><br>当ValueAnimator计算完已完成动画分数后，它会调用当前设置的TimeInterpolator，去计算得到一个interpolated（插值）分数，在计算过程中，已完成动画百分比会被加入到新的插值计算中。</p>
<p><strong>过程三：计算属性值</strong><br>当插值分数计算完成后，ValueAnimator 会根据插值分数调用合适的 TypeEvaluator去计算运动中的属性值。<br>以上分析引入了两个概念：已完成动画分数（elapsed fraction）、插值分数( interpolated fraction )。</p>
<h2 id="2-2-核心类"><a href="#2-2-核心类" class="headerlink" title="2.2 核心类"></a>2.2 核心类</h2><p><img src="/img/anim_basic_knowledge/propertyanimhirachy.png" alt="属性动画类继承关系"> </p>
<p>###2.2.1 Interpolators</p>
<p>插值器：时间的函数，定义了动画的变化律。<br>插值器只需实现一个方法：<code>getInterpolation(float input)</code>,其作用就是把0到1的elapsed   fraction变化映射到另一个interpolated fraction。  Interpolator接口的直接继承自<code>TimeInterpolator</code>，内部没有任何方法，而<code>TimeInterpolator</code>只有一个<code>getInterpolation</code>方法，所以所有的插值器只需实现<code>getInterpolation</code>方法即可。<br>传入参数是正常执行动画的时间点，返回值是调用者真正想要它执行的时间点。传入参数是{0,1}，返回值一般也是{0,1}。{0,1}表示整段动画的过程。中间的0.2、0.3等小数表示在整个动画（原本是匀速的）中的位置，其实就是一个比值。如果返回值是负数，会沿着相反的方向执行。如果返回的是大于1，会超出正方向执行。也就是说，动画可能在你指定的值上下波动，大多数情况下是在指定值的范围内。<br><code>getInterpolation(float input)</code>改变了默认动画的时间点elapsed fraction，根据时间点interpolated fraction得到的是与默认时间点不同的属性值，插值器的原理就是通过改变实际执行动画的时间点，提前或延迟默认动画的时间点来达到加速/减速的效果。动画插值器目前都只是对动画执行过程的时间进行修饰，并没有对轨迹进行修饰。  </p>
<p>简单点解释这个方法，就是当要执行input的时间时，通过Interpolator计算返回另外一个时间点，让系统执行另外一个时间的动画效果。</p>
<h3 id="2-2-2-Evaluators"><a href="#2-2-2-Evaluators" class="headerlink" title="2.2.2 Evaluators"></a>2.2.2 Evaluators</h3><p>Evaluators 告诉属性动画系统如何去计算一个属性值。它们通过Animator提供的动画的起始和结束值去计算一个动画的属性值。<br>属性系统提供了以下几种Evaluators：<br>1.IntEvaluator<br>2.FloatEvaluator<br>3.ArgbEvaluator<br>这三个由系统提供，分别用于计算int，float，color型（十六进制）属性的计算器<br>4.TypeEvaluator<br>一个用于用户自定义计算器的接口，如果你的对象属性值类型，不是int，float，或者color类型，你必须实现这个接口，去定义自己的数据类型。  </p>
<p><code>TypeEvaluator</code>接口只有一个方法，就是<code>evaluate()</code>方法，它允许你使用的animator返回一个当前动画点的属性值。</p>
<p><strong>TimeInterpolator和TypeEvaluator的区别</strong><br>首先明确动画属性值的计算包括三步，其中第二步和第三步分别需要借助<code>TimeInterpolator</code>和<code>TypeEvluator</code>完成。</p>
<p><code>TypeEvaluator</code>所做的是根据数据结构计算最终的属性值，允许你定义自己的数据结构，这是官方对它的真正定义，如果你所定义的属性值的数据类型不是float、int、color类型，那么你需要实现TypeEvaluator接口的<code>evaluate()</code>方法，自己进行属性值的计算  </p>
<p><code>Interpolator</code>更倾向于你定义一种运动的变化率，比如匀速、加速、减速等，官方对Interpolator的定义也确实是这样的：</p>
<blockquote>
<p>A time interpolator defines the rate of change of an &gt;animation. This allows animations to have non-linear &gt;motion, such as acceleration and deceleration.  </p>
</blockquote>
<p>对于自定义高级动画时，弄清<code>TimeInterpolator</code>和<code>TypeEvaluator</code>非常重要，如果你希望要自定义自己的动画，那么这两个函数肯定是关键部分，一个是定义动画变化率，一个是定义数据结构和属性值计算方式，两者共同决定了一个动画的运动。  </p>
<h3 id="2-2-3-ValueAnimator"><a href="#2-2-3-ValueAnimator" class="headerlink" title="2.2.3 ValueAnimator"></a>2.2.3 ValueAnimator</h3><p>属性动画中的主要的时序引擎，如动画时间，开始、结束属性值，相应时间属性值计算方法等。包含了所有计算动画值的核心函数。也包含了每一个动画时间上的细节，信息，一个动画是否重复，是否监听更新事件等，并且还可以设置自定义的计算类型。  </p>
<p>使用ValueAnimator实现动画需要手动更新：<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line">ValueAnimator animation = ValueAnimator.ofFloat(<span class="number">0f</span>, <span class="number">1f</span>);</div><div class="line">animation.setDuration(<span class="number">1000</span>);</div><div class="line">animation.addUpdateListener(<span class="keyword">new</span> AnimatorUpdateListener() &#123;</div><div class="line"><span class="meta">@Override</span></div><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onAnimationUpdate</span><span class="params">(ValueAnimator animation)</span> </span>&#123;</div><div class="line">Log.i(<span class="string">"update"</span>, ((Float) animation.getAnimatedValue()).toString());</div><div class="line">&#125;</div><div class="line">&#125;);</div><div class="line">animation.setInterpolator(<span class="keyword">new</span> CycleInterpolator(<span class="number">3</span>));</div><div class="line">animation.start();</div></pre></td></tr></table></figure></p>
<p>###2.2.4 ObjectAnimator<br>继承自<code>ValueAnimator</code>，允许你指定要进行动画的对象以及该对象的一个属性。该类会根据计算得到的新值自动更新属性。也就是说上Property Animation的两个步骤都实现了。大多数的情况，你使用<code>ObjectAnimator</code>就足够了，因为它使得目标对象动画值的处理过程变得简单，不用再向<code>ValueAnimator</code>那样自己写动画更新的逻辑。但<code>ObjectAnimator</code>有一定的限制，比如它需要目标对象的属性提供指定的处理方法，这个时候你需要根据自己的需求在<code>ObjectAnimator</code>和<code>ValueAnimator</code>中做个选择了，看哪种实现更简便。  </p>
<p><code>ObjectAnimator</code>的自动更新功能，依赖于属性身上的<code>setter</code>和<code>getter</code>方法，所以为了让<code>ObjectAnimator</code>能够正确的更新属性值，你必须遵从以下规范:  </p>
<ol>
<li>该对象的属性必须有<code>get</code>和<code>set</code>方法（方法的格式必须是驼峰式），方法格式为set<propertyname>()，因为ObjectAnimator会自动更新属性，它必须能够访问到属性的<code>setter</code>方法，比如属性名为<code>foo</code>,你就需要一个<code>setFoo()</code>方法，如果setter方法不存在，你有三种选择：<br>a.添加setter方法<br>b.使用包装类。通过该包装类通过一个有效的setter方法获取或者改变属性值的方法，然后应用于原始对象，比如NOA的<code>AnimatorProxy</code>。<br>c.使用ValueAnimator代替  </propertyname></li>
</ol>
<p>（这3点的意思总结起来就是一定要有一个<code>setter</code>方法，让<code>ObjectAnimator</code>能够访问到）  </p>
<ol>
<li><p>如果你为ObjectAnimator的工厂方法的可变参数只传递了一个值，那么会被作为动画的结束值。  </p>
</li>
<li><p>注意，属性的<code>getter</code>方法和<code>setter</code>方法必须必须是相对应的，比如你构造了一个如下的<code>ObjectAnimator</code>，那么<code>getter</code>和<code>setter</code>方法就应该为：  </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">targetObject.setPropName(float) 和targetObject.getPropName(float) :</div><div class="line">ObjectAnimator.ofFloat(targetObject, &quot;propName&quot;, 1f)</div></pre></td></tr></table></figure>
</li>
<li><p>根据动画的目标属性或者对象不同，你可能需要调用某一个View的<code>invalidate</code>方法，根据新的动画值去强制屏幕重绘该View。可以在<code>onAnimateonUpdate()</code>回调方法中去做。比如，对一个Drawable的颜色属性进行动画，只有当对象重绘自身的时候，才会导致该属性的更新，（不像平移或者缩放那样是实时的）。一个View的所有setter属性方法，比如<code>setAlpha()</code>和<code>setTranslationX()</code>都可以适当的更新View。因此你不需要在重绘的时候为这些方法传递新的值。更多关于 Listener的信息，可以参考第四部分Animation Listeners。  </p>
</li>
</ol>
<p><strong>简单总结下：</strong><br>当你不希望向外暴露<code>Setter</code>方法的时候，或者希望获取到动画值统一做处理的话，亦或只需要一个简单的时序机制(拥有动画的各种值)的话，那么你可以选择使用<code>ValueAnimator</code>，它更简单。如果你就是希望更新动画，为了简便，可以使用<code>ObjectAnimator</code>，但自定义的属性必须有<code>setter</code>和<code>getter</code>方法，并且它们必须都是标准的驼峰式（确保内部能够调用），必须有结束值。你可以实现<code>Animator.AnimatorListener</code>接口根据自己的需求去更新View。  </p>
<p>###2.2.5 AnimatorSet<br>提供组合动画能力的类。并可设置组中动画的时序关系，如同时播放、有序播放或延迟播放。<code>Elevator</code>会告诉属性动画系统如何计算一个属性的值，它们会从<code>Animator</code>类中获取时序数据，比如开始和结束值，并依据这些数据计算动画的属性值。  </p>
<p><strong>小结：</strong><br><code>TypeEvaluator</code><br>定义了属性值的计算方式，有int,float,color类型，根据属性的开始、结束值和插值一起计算出当前时间的属性值，终极方法，整个动画属性值计算过程的结尾。  </p>
<p><code>TimeInterpolation</code><br>插值器都必须实现的接口，定义了动画的变化率，如线性，非线性。</p>
<p><code>ValueAnimator</code>与<code>ObjectAnimator</code>：<br>两者都可以进行属性动画，但是<code>ObjectAnimator</code>更加简单，不用去做更新属性值的计算，但是必须要提供标准的<code>setter</code>和<code>getter</code>方法，让<code>ObjectAnimator</code>能够获取和更新属性值。</p>
<h3 id="2-2-6-ViewPropertyAnimator"><a href="#2-2-6-ViewPropertyAnimator" class="headerlink" title="2.2.6 ViewPropertyAnimator"></a>2.2.6 ViewPropertyAnimator</h3><p>可以方便的为某个View的多个属性添加并行的动画，只使用一个<code>ViewPropertyAnimator</code>对象就可以完成。它的行为更像一个<code>ObjectAnimator</code>，因为它修改的是对象的实际属性值。但它为一次性给多个属性添加动画提供了方便，而且使用<code>ViewPropertyAnimator</code>的代码更连贯更易读。<br>下面的代码段分别展示了使用多个<code>ObjectAnimator</code>对象、一个<code>ObjectAnimator</code>对象、 <code>ViewPropertyAnimator</code>同时为一个View的X和Y属性添加动画的示例：  </p>
<p><strong>多个ObjectAnimator结合AnimatorSet实现</strong><br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">ObjectAnimator animX = ObjectAnimator.ofFloat(myView, <span class="string">"x"</span>, <span class="number">50f</span>);</div><div class="line">ObjectAnimator animY = ObjectAnimator.ofFloat(myView, <span class="string">"y"</span>, <span class="number">100f</span>);</div><div class="line">AnimatorSet animSetXY = <span class="keyword">new</span> AnimatorSet();</div><div class="line">animSetXY.playTogether(animX, animY);</div><div class="line">animSetXY.start();</div></pre></td></tr></table></figure></p>
<p><strong>一个ObjectAnimator结合多个PropertyValuesHolder实现</strong><br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">PropertyValuesHolder pvhX = PropertyValuesHolder.ofFloat(<span class="string">"x"</span>, <span class="number">50f</span>);</div><div class="line">PropertyValuesHolder pvhY = PropertyValuesHolder.ofFloat(<span class="string">"y"</span>, <span class="number">100f</span>);</div><div class="line">ObjectAnimator.ofPropertyValuesHolder(myView, pvhX, pvyY).start();</div></pre></td></tr></table></figure></p>
<p><strong>ViewPropertyAnimator: 只需一行代码</strong>  </p>
<p><code>myView.animate().x(50f).y(100f);//myView.animate()直接返回一个ViewPropertyAnimator对象</code></p>
<h3 id="2-2-7-PropertyValuesHolder"><a href="#2-2-7-PropertyValuesHolder" class="headerlink" title="2.2.7 PropertyValuesHolder"></a>2.2.7 PropertyValuesHolder</h3><p>顾名思义，该类持有属性，相关属性值的操作以及属性的setter，getter方法的创建，属性值以Keyframe来承载，最终由KeyframeSet统一处理。</p>
<h3 id="2-2-8-KeyFrame"><a href="#2-2-8-KeyFrame" class="headerlink" title="2.2.8 KeyFrame"></a>2.2.8 KeyFrame</h3><p>一个<code>keyframe</code>对象由一对 time / value的键值对组成，可以为动画定义某一特定时间的特定状态。<br>每个<code>keyframe</code>可以拥有自己的插值器，用于控制前一帧和当前帧的时间间隔间内的动画。  </p>
<p><code>Keyframe.ofFloat(0f,0f);</code><br>第一个参数为：要执行该帧动画的时间节点（elapsed time / duration）<br>第二个参数为属性值。<br>因此如果你想指定某一特定时间的特定状态，那么简单的使用Object<code>Animator</code>就满足不了你了，因为，<code>ObjectAnimator.ofInt(....)</code>类似的工厂方法，无法指定特定的时间点的状态。</p>
<p><strong>每个KeyFrame的Interpolator</strong><br>每个<code>KeyFrame</code>其实也有个<code>Interpolator</code>。如果没有设置，默认是线性的。之前为<code>Animator</code>设置的<code>Interpolator</code>是整个动画的，而系统允许你为每一<code>KeyFrame</code>的单独定义<code>Interpolator</code>，系统这样做的目的是允许你在某一个<code>keyFrame</code>做特殊的处理，也就是整体上是按照你的插值函数来计算，但是，如果你希望某个或某些<code>KeyFrame</code>会有不同的动画表现，那么你可以为这个<code>keyFrame</code>设置<code>Interpolator</code>。  </p>
<p><strong>因此，Keyframe的定制性更高，你如果想精确控制某一个时间点的动画值及其运动规律，你可以自己创建特定的Keyframe</strong>  </p>
<p><strong>Keyframe使用</strong><br>为了实例化一个<code>keyframe</code>对象，你必须使用某一个工厂方法：ofInt(), ofFloat(), or ofObject() 去获取合适的<code>keyframe</code>类型，然后你调用<code>ofKeyframe</code>工厂方法去获取一个<code>PropertyValuesHolder</code>对象，一旦你拥有了该对象，你可以将PropertyValuesHolder作为参数获取一个<code>Animator</code>，如下：<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">Keyframe kf0 = Keyframe.ofFloat(<span class="number">0f</span>, <span class="number">0f</span>);</div><div class="line">Keyframe kf1 = Keyframe.ofFloat(.<span class="number">5f</span>, <span class="number">360f</span>);</div><div class="line">Keyframe kf2 = Keyframe.ofFloat(<span class="number">1f</span>, <span class="number">0f</span>);</div><div class="line">PropertyValuesHolder pvhRotation = PropertyValuesHolder.ofKeyframe(<span class="string">"rotation"</span>, kf0, kf1, kf2);<span class="comment">//动画属性名，可变参数</span></div><div class="line">ObjectAnimator rotationAnim = ObjectAnimator.ofPropertyValuesHolder(target, pvhRotation)</div><div class="line">rotationAnim.setDuration(<span class="number">5000</span>);</div></pre></td></tr></table></figure></p>
<h3 id="2-2-9-KeyFrameSet"><a href="#2-2-9-KeyFrameSet" class="headerlink" title="2.2.9 KeyFrameSet"></a>2.2.9 KeyFrameSet</h3><p>根据Animator传入的值，为当前动画创建一个特定类型的KeyFrame集合。<br>通常通过ObjectAnimator.ofFloat(…)进行赋值时，这些值其实是通过一个KeyFrameSet来维护的<br>比如：<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">ObjectAnimator.ofFloat(target, <span class="string">"translateX"</span>, <span class="number">50</span>, <span class="number">100</span>, <span class="number">200</span>);</div></pre></td></tr></table></figure></p>
<p>调用者传入的values 为 50,100,200，则numKeyframs = 3，那么创建出相应的Keyframe为：<br>Keyframe(0,50)，Keyframe(1/2,100)，Keyframe(1,200), 时间点 0，1/2，1 都是按比例划分的    </p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> KeyframeSet <span class="title">ofFloat</span><span class="params">(<span class="keyword">float</span>... values)</span> </span>&#123;</div><div class="line"><span class="keyword">int</span> numKeyframes = values.length;</div><div class="line">FloatKeyframe keyframes[] = <span class="keyword">new</span> FloatKeyframe[Math.max(numKeyframes,<span class="number">2</span>)];</div><div class="line"><span class="keyword">if</span> (numKeyframes == <span class="number">1</span>) &#123;</div><div class="line">keyframes[<span class="number">0</span>] = (FloatKeyframe) Keyframe.ofFloat(<span class="number">0f</span>);</div><div class="line">keyframes[<span class="number">1</span>] = (FloatKeyframe) Keyframe.ofFloat(<span class="number">1f</span>, values[<span class="number">0</span>]);</div><div class="line">&#125; <span class="keyword">else</span> &#123;</div><div class="line">keyframes[<span class="number">0</span>] = (FloatKeyframe) Keyframe.ofFloat(<span class="number">0f</span>, values[<span class="number">0</span>]);</div><div class="line"><span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt; numKeyframes; ++i) &#123;</div><div class="line">keyframes[i] = (FloatKeyframe) Keyframe.ofFloat((<span class="keyword">float</span>) i / (numKeyframes - <span class="number">1</span>), values[i]);<span class="comment">//这里是关键</span></div><div class="line">&#125;</div><div class="line">&#125;</div><div class="line"><span class="keyword">return</span> <span class="keyword">new</span> FloatKeyframeSet(keyframes);</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h2 id="2-3-在XML中声明属性动画"><a href="#2-3-在XML中声明属性动画" class="headerlink" title="2.3 在XML中声明属性动画"></a>2.3 在XML中声明属性动画</h2><p>通过在XML中定义的动画，可以很方便的在多个Activities中重用而且更容易编辑，复用性强。为了区分新的属性动画，从3.1开始，你应<code>res/animator/</code>下存放属性动画的资源文件，使用<code>animator</code>文件夹是可选的，但是如果你想在Eclipse ADT插件中使用布局编辑工具（ADT 11.0.0+），就必须在<code>res/animator</code>文件夹下存放了，因为ADT只会查找<code>res/animator</code>文件夹下的属性动画资源文件。</p>
<p><strong>属性动画支持的Tag有</strong><br>ValueAnimator - <code>&lt;animator&gt;</code><br>ObjectAnimator - <code>&lt;objectAnimator&gt;</code><br>AnimatorSet - <code>&lt;set&gt;</code><br><figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">set</span> <span class="attr">android:ordering</span>=<span class="string">"sequentially"</span>&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">set</span>&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">objectAnimator</span></span></div><div class="line"><span class="attr">android:propertyName</span>=<span class="string">"x"</span></div><div class="line"><span class="attr">android:duration</span>=<span class="string">"500"</span></div><div class="line"><span class="attr">android:valueTo</span>=<span class="string">"400"</span></div><div class="line"><span class="attr">android:valueType</span>=<span class="string">"intType"</span>/&gt;</div><div class="line"><span class="tag">&lt;<span class="name">objectAnimator</span></span></div><div class="line"><span class="attr">android:propertyName</span>=<span class="string">"y"</span></div><div class="line"><span class="attr">android:duration</span>=<span class="string">"500"</span></div><div class="line"><span class="attr">android:valueTo</span>=<span class="string">"300"</span></div><div class="line"><span class="attr">android:valueType</span>=<span class="string">"intType"</span>/&gt;</div><div class="line"><span class="tag">&lt;/<span class="name">set</span>&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">objectAnimator</span></span></div><div class="line"><span class="attr">android:propertyName</span>=<span class="string">"alpha"</span></div><div class="line"><span class="attr">android:duration</span>=<span class="string">"500"</span></div><div class="line"><span class="attr">android:valueTo</span>=<span class="string">"1f"</span>/&gt;</div><div class="line"><span class="tag">&lt;/<span class="name">set</span>&gt;</span></div></pre></td></tr></table></figure></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">AnimatorSet set = (AnimatorSet) AnimatorInflater.loadAnimator(myContext,</div><div class="line">R.anim.property_animator);</div><div class="line">set.setTarget(myObject);</div><div class="line">set.start();</div></pre></td></tr></table></figure>
<p><strong>目录</strong><br>res/animator/filename.xm  </p>
<p><strong>编译后的资源为</strong><br><code>ValueAnimator</code>, <code>ObjectAnimator</code>, or <code>AnimatorSet</code>　 </p>
<p>XML文件的根元素必须为<code>&lt;set&gt;</code>,<code>&lt;objectAnimator&gt;</code>, or <code>&lt;valueAnimator&gt;</code>之一。也可以在一个set中组织不同的动画，包含其它<code>&lt;set&gt;</code>元素,也就是说，可以嵌套。</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">set</span>  </span></div><div class="line"><span class="attr">android:ordering</span>=<span class="string">[</span>"<span class="attr">together</span>" | "<span class="attr">sequentially</span>"]&gt;  </div><div class="line"></div><div class="line"><span class="tag">&lt;<span class="name">objectAnimator</span>  </span></div><div class="line"><span class="attr">android:propertyName</span>=<span class="string">"string"</span>  </div><div class="line"><span class="attr">android:duration</span>=<span class="string">"int"</span>  </div><div class="line"><span class="attr">android:valueFrom</span>=<span class="string">"float | int | color"</span>  </div><div class="line"><span class="attr">android:valueTo</span>=<span class="string">"float | int | color"</span>  </div><div class="line"><span class="attr">android:startOffset</span>=<span class="string">"int"</span>  </div><div class="line"><span class="attr">android:repeatCount</span>=<span class="string">"int"</span>  </div><div class="line"><span class="attr">android:repeatMode</span>=<span class="string">[</span>"<span class="attr">repeat</span>" | "<span class="attr">reverse</span>"]  </div><div class="line"><span class="attr">android:valueType</span>=<span class="string">[</span>"<span class="attr">intType</span>" | "<span class="attr">floatType</span>"]/&gt;  </div><div class="line"></div><div class="line"><span class="tag">&lt;<span class="name">animator</span>  </span></div><div class="line"><span class="attr">android:duration</span>=<span class="string">"int"</span>  </div><div class="line"><span class="attr">android:valueFrom</span>=<span class="string">"float | int | color"</span>  </div><div class="line"><span class="attr">android:valueTo</span>=<span class="string">"float | int | color"</span>  </div><div class="line"><span class="attr">android:startOffset</span>=<span class="string">"int"</span>  </div><div class="line"><span class="attr">android:repeatCount</span>=<span class="string">"int"</span>  </div><div class="line"><span class="attr">android:repeatMode</span>=<span class="string">[</span>"<span class="attr">repeat</span>" | "<span class="attr">reverse</span>"]  </div><div class="line"><span class="attr">android:valueType</span>=<span class="string">[</span>"<span class="attr">intType</span>" | "<span class="attr">floatType</span>"]/&gt;  </div><div class="line"></div><div class="line"><span class="tag">&lt;<span class="name">set</span>&gt;</span>  </div><div class="line">...  </div><div class="line"><span class="tag">&lt;/<span class="name">set</span>&gt;</span>  </div><div class="line"><span class="tag">&lt;/<span class="name">set</span>&gt;</span></div></pre></td></tr></table></figure>
<h3 id="2-3-2-元素介绍"><a href="#2-3-2-元素介绍" class="headerlink" title="2.3.2 元素介绍"></a>2.3.2 元素介绍</h3><h3 id="2-3-2-1-lt-set-gt"><a href="#2-3-2-1-lt-set-gt" class="headerlink" title="2.3.2.1 &lt;set&gt;"></a>2.3.2.1 <code>&lt;set&gt;</code></h3><p>动画集合节点，有一个属性ordering，表示它的子动画启动方式是先后有序的还是同时。</p>
<p>属性<br>sequentially：动画按照先后顺序<br>together (default) ：动画同时启动  </p>
<h3 id="2-3-2-2-lt-objectAnimator-gt"><a href="#2-3-2-2-lt-objectAnimator-gt" class="headerlink" title="2.3.2.2 &lt;objectAnimator&gt;"></a>2.3.2.2 <code>&lt;objectAnimator&gt;</code></h3><p>一个对象的一个属性，相应的Java类为:<code>ObjectAnimator</code>  </p>
<p>属性<br>android:propertyName：<br>String类型，必须要设定的值，代表要执行动画的属性，通过名字引用，比如你可以指定了一个View的”alpha” 或者 “backgroundColor” ，这个objectAnimator元素没有暴露target属性，因此不能够在XML中执行一个动画，必须通过调用<code>loadAnimator()</code> 填充你的XML动画资源，并且调用<code>setTarget()</code> 应用到拥有这个属性的目标对象上。</p>
<p><code>android:valueTo</code><br>Float、int或者color，也是必须值，表明了动画结束的点，颜色由6位十六进制的数字表示。  </p>
<p><code>android:valueFrom</code><br>相对应valueTo，动画的起始点，如果没有指定，系统会通过属性身上的get 方法获取 ，颜色也是6位十六进制的数字表示。  </p>
<p><code>android:duration</code><br>动画的时长，int类型，以毫秒为单位，默认为300毫秒。  </p>
<p><code>android:startOffset</code><br>动画延迟的时间，从调用start方法后开始计算，int型，毫秒为单位，  </p>
<p><code>android:repeatCount</code><br>一个动画的重复次数，int型，”-1“表示无限循环，”1“表示动画在第一次执行完成后重复执行一次，也就是两次，默认为0，不重复执行。  </p>
<p><code>android:repeatMode</code><br>重复模式：int型，当一个动画执行完的时候应该如何处理。该值必须是正数或者是-1，<br>“reverse”<br>会使得按照动画向相反的方向执行，可实现类似钟摆效果。<br>“repeat”<br>会使得动画每次都从头开始循环。  </p>
<p><code>android:valueType</code><br>关键参数，如果该value是一个颜色，那么就不需要指定，因为动画框架会自动的处理颜色值。有intType和floatType两种：分别说明动画值为int和float型。  </p>
<h3 id="2-3-2-3-lt-animator-gt"><a href="#2-3-2-3-lt-animator-gt" class="headerlink" title="2.3.2.3 &lt;animator&gt;"></a>2.3.2.3 <code>&lt;animator&gt;</code></h3><p>在一个特定的时间里执行一个动画。相对应的是ValueAnimator.所有的属性和<objectanimator>一样<br>android:valueTo<br>android:valueFrom<br>android:duration<br>android:startOffset<br>android:repeatCount<br>android:repeatMode<br>android:valueType<br>Value Description<br>floatType (default)  </objectanimator></p>
<p>res/animator/property_animator.xml:<br><figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">set</span> <span class="attr">android:ordering</span>=<span class="string">"sequentially"</span>&gt;</span>  </div><div class="line"><span class="tag">&lt;<span class="name">set</span>&gt;</span>  </div><div class="line"><span class="tag">&lt;<span class="name">objectAnimator</span>  </span></div><div class="line"><span class="attr">android:propertyName</span>=<span class="string">"x"</span>  </div><div class="line"><span class="attr">android:duration</span>=<span class="string">"500"</span>  </div><div class="line"><span class="attr">android:valueTo</span>=<span class="string">"400"</span>  </div><div class="line"><span class="attr">android:valueType</span>=<span class="string">"intType"</span>/&gt;  </div><div class="line"><span class="tag">&lt;<span class="name">objectAnimator</span>  </span></div><div class="line"><span class="attr">android:propertyName</span>=<span class="string">"y"</span>  </div><div class="line"><span class="attr">android:duration</span>=<span class="string">"500"</span>  </div><div class="line"><span class="attr">android:valueTo</span>=<span class="string">"300"</span>  </div><div class="line"><span class="attr">android:valueType</span>=<span class="string">"intType"</span>/&gt;  </div><div class="line"><span class="tag">&lt;/<span class="name">set</span>&gt;</span>  </div><div class="line"><span class="tag">&lt;<span class="name">objectAnimator</span>  </span></div><div class="line"><span class="attr">android:propertyName</span>=<span class="string">"alpha"</span>  </div><div class="line"><span class="attr">android:duration</span>=<span class="string">"500"</span>  </div><div class="line"><span class="attr">android:valueTo</span>=<span class="string">"1f"</span>/&gt;  </div><div class="line"><span class="tag">&lt;/<span class="name">set</span>&gt;</span></div></pre></td></tr></table></figure></p>
<p>为了执行该动画，必须在代码中将该动画资源文件填充为一个AnimationSet对象，然后在执行动画前，为目标对象设置所有的动画集合。<br>简便的方法就是通过setTarget方法为目标对象设置动画集合，代码如下：<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">AnimatorSet set = (AnimatorSet) AnimatorInflater.loadAnimator(myContext,  </div><div class="line">R.anim.property_animator);  </div><div class="line">set.setTarget(myObject);  </div><div class="line">set.start();</div></pre></td></tr></table></figure></p>
<p>#三 View anim与property anim 的比较</p>
<p>####View anim 系统<br>view animation system提供的能力只能够为View添加动画。因此如果你想为非View对象添加动画，就必须自己去实现，<br>view animation system在View动画的展现方面也是有约束的，只暴露了View的很少方面。比如View支持缩放和旋转，但不支持背景颜色的动画。<br>view animation system的另一劣势是，其改变的是View的绘制效果，真正的View的属性保持不变，比如无论你在对话中如何缩放Button的大小，Button的有效点击区域还是没有应用到动画时的区域，其位置与大小都不变。<br>但是View animation system只需花费很少时间创建而且只需很少的代码。如果View 动画完成了你所有的动作，或者你存在的代码已经达到了你想要的效果，就没必要使用property 动画系统了。</p>
<p>####property anim 系统<br>完全弥补了View anim System的缺陷，你可以为一个对象的任何属性添加动画，（View或者非View），同时对象自己也会被修改。<br>并且当属性变化的时候，property Anim系统会自动的刷新屏幕。<br>属性动画系统在处理动画方面也更加强劲。更高级的，你可以指定动画的属性，比如颜色，位置，大小，定义动画的插值器并且同步多个动画。<br>并且在Property Animation中，改变的是对象的实际属性，如Button的缩放，Button的位置与大小属性值都改变了。而且Property Animation不止可以应用于View，还可以应用于任何对象。</p>
<p>平时使用的简单动画特效，使用View动画就可以满足，但是如果你想做的更加复杂，比如背景色的动画，或者不仅是View，还希望对其它对象添加动画等，那么你就得考虑使用Property动画了。  </p>
<p>更多动画开源库及使用，可以参考个人博客：<a href="http://www.lightskystreet.com/categories/Android/Android%E5%8A%A8%E7%94%BB/">Android动画系列</a>，其中介绍了一些基本使用，也提到了一些GitHub上的动画开源库，可以作为Android动画学习的资料  </p>
<p>参考文献：<br><a href="http://developer.android.com/guide/topics/resources/animation-resource.html#val-animator-element" target="_blank" rel="external">http://developer.android.com/guide/topics/resources/animation-resource.html#val-animator-element</a><br><a href="http://blog.csdn.net/liuhe688/article/details/6660823" target="_blank" rel="external">http://blog.csdn.net/liuhe688/article/details/6660823</a><br><a href="http://developer.android.com/guide/topics/resources/animation-resource.html#Property" target="_blank" rel="external">http://developer.android.com/guide/topics/resources/animation-resource.html#Property</a><br><a href="http://developer.android.com/guide/topics/graphics/prop-animation.html" target="_blank" rel="external">http://developer.android.com/guide/topics/graphics/prop-animation.html</a><br><a href="http://android-developers.blogspot.jp/2011/02/animation-in-honeycomb.html" target="_blank" rel="external">http://android-developers.blogspot.jp/2011/02/animation-in-honeycomb.html</a><br><a href="http://www.cnblogs.com/angeldevil/archive/2011/12/02/2271096.html" target="_blank" rel="external">http://www.cnblogs.com/angeldevil/archive/2011/12/02/2271096.html</a><br><a href="http://cogitolearning.co.uk/?p=1078" target="_blank" rel="external">http://cogitolearning.co.uk/?p=1078</a><br><a href="http://www.2cto.com/kf/201306/222725.html" target="_blank" rel="external">http://www.2cto.com/kf/201306/222725.html</a><br><a href="http://my.oschina.net/banxi/blog/135633" target="_blank" rel="external">http://my.oschina.net/banxi/blog/135633</a><br><a href="http://zhouyunan2010.iteye.com/blog/1972789" target="_blank" rel="external">http://zhouyunan2010.iteye.com/blog/1972789</a><br><a href="http://blog.csdn.net/guolin_blog/article/details/43816093" target="_blank" rel="external">http://blog.csdn.net/guolin_blog/article/details/43816093</a></p>
</div><script type="text/javascript" src="/js/share.js?v=0.0.0" async></script><a data-url="http://www.lightskystreet.com/2015/05/23/anim_basic_knowledge/" data-id="civlq5rx7000yozcarstgx7v2" class="article-share-link">Aktie</a><div class="tags"><a href="/tags/Android动画/">Android动画</a></div><div class="post-nav"><a href="/2015/06/07/google-for-android-1-mobile-context/" class="pre">Google Developing for Android 一 － 相关上下文介绍</a><a href="/2015/02/10/philm_mvp/" class="next">开源项目Philm的MVP架构分析</a></div><div data-thread-key="2015/05/23/anim_basic_knowledge/" data-title="Android 动画基础" data-url="http://www.lightskystreet.com/2015/05/23/anim_basic_knowledge/" class="ds-share flat"><div class="ds-share-inline"><ul class="ds-share-icons-16"><li data-toggle="ds-share-icons-more"><a href="javascript:void(0);" class="ds-more">分享到：</a></li><li><a href="javascript:void(0);" data-service="weibo" class="ds-weibo">微博</a></li><li><a href="javascript:void(0);" data-service="qzone" class="ds-qzone">QQ空间</a></li><li><a href="javascript:void(0);" data-service="qqt" class="ds-qqt">腾讯微博</a></li><li><a href="javascript:void(0);" data-service="wechat" class="ds-wechat">微信</a></li></ul><div class="ds-share-icons-more"></div></div></div><div data-thread-key="2015/05/23/anim_basic_knowledge/" data-title="Android 动画基础" data-url="http://www.lightskystreet.com/2015/05/23/anim_basic_knowledge/" data-author-key="1" class="ds-thread"></div></div></div></div><div class="pure-u-1-4 hidden_mid_and_down"><div id="sidebar"><div class="widget"><form action="//www.google.com/search" method="get" accept-charset="utf-8" target="_blank" class="search-form"><input type="text" name="q" maxlength="20" placeholder="Search"/><input type="hidden" name="sitesearch" value="http://www.lightskystreet.com"/></form></div><div class="widget"><div class="widget-title"><i class="fa fa-folder-o"> Kategorien</i></div><ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/Android/">Android</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/Android/Android动画/">Android动画</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Android/MaterialDesign/">MaterialDesign</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Android/优秀项目原理解析/">优秀项目原理解析</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Android/性能优化/">性能优化</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Android/编译/">编译</a></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/Android最佳实践/">Android最佳实践</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/JS/">JS</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/RN/">RN</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Reactive/">Reactive</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Rx/">Rx</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Talk/">Talk</a></li></ul></div><div class="widget"><div class="widget-title"><i class="fa fa-star-o"> Tags</i></div><div class="tagcloud"><a href="/tags/MaterialDesign/" style="font-size: 15px;">MaterialDesign</a> <a href="/tags/Android，性能优化/" style="font-size: 15px;">Android，性能优化</a> <a href="/tags/Android，架构/" style="font-size: 15px;">Android，架构</a> <a href="/tags/Android/" style="font-size: 15px;">Android</a> <a href="/tags/Anim/" style="font-size: 15px;">Anim</a> <a href="/tags/Android，适配/" style="font-size: 15px;">Android，适配</a> <a href="/tags/Android动画/" style="font-size: 15px;">Android动画</a> <a href="/tags/Android，最佳实践/" style="font-size: 15px;">Android，最佳实践</a> <a href="/tags/优秀项目原理解析/" style="font-size: 15px;">优秀项目原理解析</a> <a href="/tags/JS学习笔记/" style="font-size: 15px;">JS学习笔记</a> <a href="/tags/性能优化/" style="font-size: 15px;">性能优化</a> <a href="/tags/Android，编译/" style="font-size: 15px;">Android，编译</a> <a href="/tags/Android，原理解析/" style="font-size: 15px;">Android，原理解析</a> <a href="/tags/Rx/" style="font-size: 15px;">Rx</a> <a href="/tags/PropertyViewAnim/" style="font-size: 15px;">PropertyViewAnim</a> <a href="/tags/RN/" style="font-size: 15px;">RN</a> <a href="/tags/Reactive/" style="font-size: 15px;">Reactive</a> <a href="/tags/Rexactive/" style="font-size: 15px;">Rexactive</a> <a href="/tags/ViewAnim/" style="font-size: 15px;">ViewAnim</a> <a href="/tags/ViewPager/" style="font-size: 15px;">ViewPager</a> <a href="/tags/View绘制机制/" style="font-size: 15px;">View绘制机制</a> <a href="/tags/PropertyAnim，源码分析/" style="font-size: 15px;">PropertyAnim，源码分析</a></div></div><div class="widget"><div class="widget-title"><i class="fa fa-file-o"> Letzte</i></div><ul class="post-list"><li class="post-list-item"><a class="post-list-link" href="/2016/11/11/android-dex-plugin/">multidex与插件化</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/10/19/android-optimize-image-download-size/">Android性能优化-减小图片下载大小</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/10/18/android-optimize-thread/">Android性能优化-线程性能优化</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/10/17/android-optimize-apk/">Android性能优化-减小APK大小</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/10/16/android-optimize-memory/">Android性能优化-内存优化</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/10/16/android-optimize-background/">Android性能优化-App后台优化</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/10/15/android-optimize-start/">Android性能优化-App启动优化</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/06/16/js-str-arr/">JS学习-字符串和数组</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/06/13/js-inherit/">JS学习-封装和继承</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/06/08/js-func/">JS学习-函数</a></li></ul></div><div class="widget"><div class="comments-title"><i class="fa fa-comment-o"> Letzte Kommentare</i></div><div data-num-items="5" data-show-avatars="0" data-show-time="1" data-show-admin="0" data-excerpt-length="32" data-show-title="1" class="ds-recent-comments"></div></div></div></div><div class="pure-u-1 pure-u-md-3-4"><div id="footer">© <a href="/." rel="nofollow">lightSky'Blog.</a> Powered by<a rel="nofollow" target="_blank" href="https://hexo.io"> Hexo.</a><a rel="nofollow" target="_blank" href="https://github.com/tufu9441/maupassant-hexo"> Theme</a> by<a rel="nofollow" target="_blank" href="https://github.com/pagecho"> Cho.</a></div></div></div><a id="rocket" href="#top" class="show"></a><script type="text/javascript" src="/js/totop.js?v=0.0.0" async></script><script type="text/javascript" src="//cdn.bootcss.com/fancybox/2.1.5/jquery.fancybox.pack.js" async></script><script type="text/javascript" src="/js/fancybox.js?v=0.0.0" async></script><link rel="stylesheet" type="text/css" href="/css/jquery.fancybox.css?v=0.0.0"><script>var duoshuoQuery = {short_name:'lightSky'};
(function() {
    var ds = document.createElement('script');
    ds.type = 'text/javascript';ds.async = true;
    ds.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') + '//static.duoshuo.com/embed.js';
    ds.charset = 'UTF-8';
    (document.getElementsByTagName('head')[0]
        || document.getElementsByTagName('body')[0]).appendChild(ds);
})();
</script><script>(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
ga('create','UA-57428802-1## Your Google Analytics tracking id, e.g. UA-42425684-2','auto');ga('send','pageview');
</script><script type="text/javascript" src="/js/codeblock-resizer.js?v=0.0.0"></script><script type="text/javascript" src="/js/smartresize.js?v=0.0.0"></script></div></body></html>