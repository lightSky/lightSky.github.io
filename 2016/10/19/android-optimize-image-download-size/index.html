<!DOCTYPE html><html lang="zh-Hans"><head><meta http-equiv="content-type" content="text/html; charset=utf-8"><meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport"><meta content="yes" name="apple-mobile-web-app-capable"><meta content="black-translucent" name="apple-mobile-web-app-status-bar-style"><meta content="telephone=no" name="format-detection"><meta name="description"><title>Android性能优化-减小图片下载大小 | lightSky'Blog</title><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/normalize/4.2.0/normalize.min.css"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/pure/0.6.0/pure-min.css"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/pure/0.6.0/grids-responsive-min.css"><link rel="stylesheet" type="text/css" href="/css/style.css?v=0.0.0"><link rel="stylesheet" href="//cdn.bootcss.com/font-awesome/4.6.3/css/font-awesome.min.css"><script type="text/javascript" src="//cdn.bootcss.com/jquery/3.0.0/jquery.min.js"></script><link rel="Shortcut Icon" type="image/x-icon" href="/favicon.ico"><link rel="apple-touch-icon" href="/apple-touch-icon.png"><link rel="apple-touch-icon-precomposed" href="/apple-touch-icon.png"><link rel="alternate" type="application/atom+xml" href="/atom.xml"></head><body><div class="body_container"><div id="header"><div class="site-name"><h1 class="hidden">Android性能优化-减小图片下载大小</h1><a id="logo" href="/.">lightSky'Blog</a><p class="description"></p></div><div id="nav-menu"><a href="/." class="current"><i class="fa fa-home"> Inicio</i></a><a href="/archives/"><i class="fa fa-archive"> Archivo</i></a><a href="/about/"><i class="fa fa-user"> Acerca de</i></a><a href="/atom.xml"><i class="fa fa-rss"> RSS</i></a></div></div><div id="layout" class="pure-g"><div class="pure-u-1 pure-u-md-3-4"><div class="content_container"><div class="post"><h1 class="post-title">Android性能优化-减小图片下载大小</h1><div class="post-meta">Oct 19, 2016<span> | </span><span class="category"><a href="/categories/Android/">Android</a><a href="/categories/Android/性能优化/">性能优化</a></span><script src="https://dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js" async></script><span id="busuanzi_container_page_pv"> | <span id="busuanzi_value_page_pv"></span><span> Hits</span></span></div><a data-thread-key="2016/10/19/android-optimize-image-download-size/" href="/2016/10/19/android-optimize-image-download-size/#comments" class="ds-thread-count"></a><div class="post-content"><p>原文链接 <a href="https://developer.android.com/topic/performance/network-xfer.html" target="_blank" rel="external">https://developer.android.com/topic/performance/network-xfer.html</a></p>
<h3 id="内容概要"><a href="#内容概要" class="headerlink" title="内容概要"></a><strong>内容概要</strong></h3><ol>
<li><p>理解图片的格式 PNG JPG WebP</p>
</li>
<li><p>如何选择一种图片格式</p>
</li>
<li><p>确定准确质量值</p>
</li>
<li><p>服务端的尺寸大小</p>
<p>​</p>
</li>
</ol>
<h1 id="减小图像下载大小"><a href="#减小图像下载大小" class="headerlink" title="减小图像下载大小"></a>减小图像下载大小</h1><p>大多数流量传输都包含图像。 因此，你制作的下载的图片越小，就会为用户提供更好的网络体验。 本篇文章提供了让你的图像文件更小以及更加网络友好的指导。</p>
<h2 id="理解图像的格式"><a href="#理解图像的格式" class="headerlink" title="理解图像的格式"></a>理解图像的格式</h2><p>Android应用通常使用以下某种或多种文件格式的图片：PNG，JPG和WebP。 对于每种格式，你都可以采取措施缩小图片大小。</p>
<h3 id="PNG"><a href="#PNG" class="headerlink" title="PNG"></a>PNG</h3><p>缩小PNG文件的关键是减少构成图像的每行像素中使用的唯一颜色数。通过使用更少的颜色，可以提高在其它管道中的压缩能力。</p>
<p>减少独唯一颜色的数量会取得显着效果的原因是，PNG压缩效果基于一个水平方向相邻像素颜色变化程度的函数。因此，减少PNG图像每行中唯一颜色数量可以减少文件大小。</p>
<p>当决定是否采用这种策略时，你应该记住，减少唯一颜色的数量实际上等于对图像应用了有损编码。然而，编码工具可能不会判断一个细小的偏差导致多糟糕的视觉效果。因此，为了保证有效压缩和可接受的图像质量的平衡，你应该手动执行此工作，</p>
<p>有两个特别有用的方法你可以采取：优化索引格式和应用矢量量化。</p>
<h4 id="优化索引格式"><a href="#优化索引格式" class="headerlink" title="优化索引格式"></a>优化索引格式</h4><p>任何减少颜色的尝试都应该首先尝试优化颜色，以便将图像导出为PNG时可以使用INDEXED格式。 INDEXED颜色模式会选择最佳的256色彩，并用索引将所有像素值替换到调色板中。 结果是从1600万色彩减少到仅256色彩：等同于从每像素3（没有透明度）或4（具有透明度）字节减少到每像素1字节。这种变化向减少文件迈出了重大的一步。</p>
<a id="more"></a>
<p><img src="/img/android-optimize/indexed-image.png">    </p>
<p>图片 1.一个图像在转换为INDEXED的前后对照</p>
<p>Figure 2 展示了图像1中的调色板</p>
<p><img src="/img/android-optimize/platte.png">  </p>
<p>将图像表示为调色图像对于显着改善文件大小有很大帮助，因此，如果你的大多数图片都可以转换，可以好好研究一下。</p>
<p>当然，并不是每个图像都可以用256种色彩准确表示。 例如，某些图像可能需要257,310,512或912种颜色才能正确显示。 在这种情况下，矢量化会可能会有帮助。</p>
<h4 id="矢量化"><a href="#矢量化" class="headerlink" title="矢量化"></a>矢量化</h4><p>矢量化（VQ）也许是对创建索引图像的过程更好地描述。 VQ会对多维数进行舍入处理。 在此过程中，你图片中的所有颜色都将根据相似性进行分组。 对于给定的组，该组中的所有颜色都将被单个<em>中心点</em>值替换，这样可以最大程度地减少该单元格中的颜色错误（如果使用Voronoi术语，则为“site”）。 在图3中，绿色点表示输入颜色，而红色点是替换输入颜色的中心点。 每个单元格由蓝线界定。</p>
<p><img src="/img/android-optimize/vector-quantization.gif">    </p>
<p>图3 为图像中的颜色进行矢量化</p>
<p>将VQ应用于图像会减少了唯一颜色的数量，用视觉质量上“相当接近”的单一颜色替换每组颜色。</p>
<p>此技术也允许你为图像定义唯一颜色的最大数量。 例如，图4显示了1670万种颜色（每像素24位，或bpp）的鹦鹉头像，旁边是一个只使用16（3bpp）唯一颜色的版本。</p>
<p><img src="/img/android-optimize/vq.png">   </p>
<p>你可以明显看到有一些质量的损失; 大多数渐变颜色已经被替换，赋予图像带状效果。 因此该图片需要超过16种唯一的色彩。</p>
<p>在管道中设置VQ的步骤可以帮助你对图像中使用的唯一色彩的真实数量有更好地了解，并且可以帮助你显著地减小它们。 有很多可用的工具来帮助你实现此技术。</p>
<h3 id="JPG"><a href="#JPG" class="headerlink" title="JPG"></a>JPG</h3><p>如果你使用的是JPG图片，这里有几种只做很小的改变就可以显著节省文件大小的方法：</p>
<ul>
<li>通过不同的编码方法生成较小的文件（不影响质量）。</li>
<li>稍微调整质量以得到更好的压缩。</li>
</ul>
<p>执行这些策略通常可以将文件大小减少高达25％。</p>
<p>选择工具时，请记住照片导出工具会将不必要的元数据（如GPS信息）插入到图像中。为了最小化，你可以尝试利用现有工具删除这些信息。  </p>
<h3 id="WebP"><a href="#WebP" class="headerlink" title="WebP"></a>WebP</h3><p>WebP是Android 4.2.1（API 17）支持的较新的图像格式。 这种格式为网络图像提供了卓越的无损和有损压缩。 使用WebP，开发人员可以创建更小，更丰富的图像。 WebP无损图像文件平均比PNG小 <a href="https://developers.google.com/speed/webp/docs/webp_lossless_alpha_study#conclusions" target="_blank" rel="external">26% </a>。 这些图像文件还支持透明度（也称为alpha通道），成本只有 <a href="https://developers.google.com/speed/webp/docs/webp_lossless_alpha_study#results" target="_blank" rel="external">22%</a> 的字节。</p>
<p>WebP有损图像比同等 <a href="https://en.wikipedia.org/wiki/Structural_similarity" target="_blank" rel="external">SSIM</a> 质量指数下的JPG图像小 <a href="https://developers.google.com/speed/webp/docs/webp_study#experiment_1_webp_vs_jpeg_at_equal_ssim_index" target="_blank" rel="external">25-34%</a> 。 对于可接受有损RGB压缩的场景，有损WebP还能支持透明度，产生的文件大小通常比PNG小3倍。</p>
<p>有关WebP的详细信息，请访问 <a href="https://developers.google.com/speed/webp/" target="_blank" rel="external">WebP</a>。</p>
<h2 id="选择一种格式"><a href="#选择一种格式" class="headerlink" title="选择一种格式"></a>选择一种格式</h2><p>不同的图像格式适用于不同类型的图像。 JPG和PNG的压缩过程有很大差别，产生的效果差别也很大。</p>
<p>决定使用PNG还是JPG，通常归结于图像本身的复杂性。图5显示了两个图像，由于开发者应用了不同的压缩方案而导致很大的差别。左侧的图像有许多小细节，因此使用JPG压缩效率更高。右侧的图像，很多区域具有相同颜色，使用PNG压缩更有效。  </p>
<p><img src="/img/android-optimize/jpg-vs-png.png">  </p>
<p>图5  JPG和PNG的适用场景</p>
<p>WebP格式可以支持有损和无损模式，是PNG和JPG的理想替代品。唯一要记住的是，它只对运行Android 4.2.1（API 17）及更高版本的设备提供支持。不过幸运的是，<a href="https://developer.android.com/about/dashboards/index.html#Platform" target="_blank" rel="external">大多数设备</a>都满足这一要求。</p>
<p>图6提供了一个简单的图示来帮助你决定使用哪种压缩方案。</p>
<p><img src="/img/android-optimize/selector.png">  </p>
<p>Figure 6. 如何决定一种压缩方案</p>
<h2 id="确定最佳质量值"><a href="#确定最佳质量值" class="headerlink" title="确定最佳质量值"></a>确定最佳质量值</h2><p>有几种技术可以用来实现压缩和图像质量之间的正确权衡。有一种技术使用标量值，因此仅适用于JPG和WebP。另一种技术利用了Butteraugli库，并可用于所有图像格式。</p>
<h3 id="标量值（仅限JPG和WebP）"><a href="#标量值（仅限JPG和WebP）" class="headerlink" title="标量值（仅限JPG和WebP）"></a>标量值（仅限JPG和WebP）</h3><p>JPG和WebP的强大来自于你可以使用标量值来平衡质量和文件大小。诀窍是找出图像的正确的质量值。太低的质量水平虽然产生文件小，但以牺牲图像质量为代价。太高的质量水平会增加文件大小，对用户不友好。</p>
<p>最直接的解决方案是选择一些非最大值进行尝试。但是，请注意，质量值对每个图像的影响不同。例如，75％的质量在大多数图像上可能看起来很好，但在另一些图片上效果可能不好。你应该使用图像的代表性样本对选择的最大值进行测试。此外，要确保你是对原始图像执行所有测试，而不是压缩版本。</p>
<p>对于每天上传和发送数百万个JPG的大型媒体应用程序来说，手动调整每个资源是不切实际的。你可以根据图像类别指定几个不同的质量级别来解决这个问题。例如，可以将缩略图的质量设置为35％，因为较小的图像隐藏了更多的压缩伪影（伪影不是很好理解）。</p>
<h3 id="Butteraugli"><a href="#Butteraugli" class="headerlink" title="Butteraugli"></a>Butteraugli</h3><p>Butteraugli是一个库，用于测试图像的视觉误差阈值：观察者开始注意到图像质量下降的点。换句话说，这个项目试图将压缩图像的失真量化。</p>
<p>Butteraugli允许你定义视觉质量的目标，然后运行PNG，JPG，WebP有损和WebP无损压缩。然后，你可以选择文件大小和Butteraugli级别之间效果最佳的图像。图7示出了在视觉失真以至于用户可以感知到之前，如何使用Butteraugli来找到最低的JPG质量水平;最终文件大小减少了大约65％。</p>
<p><img src="/img/android-optimize/butteraugli.png">  </p>
<p>图7.应用Butteraugli技术之前和之后的图像。</p>
<p>Butteraugli允许你基于输出或输入进行处理。也就是说，你可以在用户感觉到图像出现明显失真之前找到最低的质量设置，或者你可以依次设置图像失真级别去观察对应的质量水平。</p>
<h2 id="服务端的尺寸"><a href="#服务端的尺寸" class="headerlink" title="服务端的尺寸"></a>服务端的尺寸</h2><p>在服务器上仅存有一种分辨率的图像的方式是很便利的。当设备访问映像时，服务器直接返回给设备该分辨率的图片。</p>
<p>虽然这个解决方案方便了开发者，但对用户来说可能很痛苦，因为这种方案迫使用户下载比实际需要更多的数据。你应该存储多个大小的图像，并根据合适的使用场景提供不同的图像。例如，对于缩略图，服务应该提供缩略图图像而不是全尺寸的版本，这样可以节省很多网络带宽。</p>
<p>这种方法对于下载速度是有利的，并且降低了使用有限或按数据量收费用户的成本。图像在设备和主存储器上也会占用更少的空间。在大图像（例如4K图像）的情况下，这种方式还减少了设备在加载图像之前调整大小的时间。</p>
<p>实现此方法需要有一个后端图像服务，以提供具有适当缓存的各种分辨率的图像。有几种现有的服务可以帮助你，例如，<a href="https://cloud.google.com/appengine/" target="_blank" rel="external">App Engine</a> 自带了调整图片大小的功能。</p>
</div><script type="text/javascript" src="/js/share.js?v=0.0.0" async></script><a data-url="http://www.lightskystreet.com/2016/10/19/android-optimize-image-download-size/" data-id="civlq5rwp000eozcayeekmm63" class="article-share-link">Cuota</a><div class="tags"><a href="/tags/Android，性能优化/">Android，性能优化</a></div><div class="post-nav"><a href="/2016/11/11/android-dex-plugin/" class="pre">multidex与插件化</a><a href="/2016/10/18/android-optimize-thread/" class="next">Android性能优化-线程性能优化</a></div><div data-thread-key="2016/10/19/android-optimize-image-download-size/" data-title="Android性能优化-减小图片下载大小" data-url="http://www.lightskystreet.com/2016/10/19/android-optimize-image-download-size/" class="ds-share flat"><div class="ds-share-inline"><ul class="ds-share-icons-16"><li data-toggle="ds-share-icons-more"><a href="javascript:void(0);" class="ds-more">分享到：</a></li><li><a href="javascript:void(0);" data-service="weibo" class="ds-weibo">微博</a></li><li><a href="javascript:void(0);" data-service="qzone" class="ds-qzone">QQ空间</a></li><li><a href="javascript:void(0);" data-service="qqt" class="ds-qqt">腾讯微博</a></li><li><a href="javascript:void(0);" data-service="wechat" class="ds-wechat">微信</a></li></ul><div class="ds-share-icons-more"></div></div></div><div data-thread-key="2016/10/19/android-optimize-image-download-size/" data-title="Android性能优化-减小图片下载大小" data-url="http://www.lightskystreet.com/2016/10/19/android-optimize-image-download-size/" data-author-key="1" class="ds-thread"></div></div></div></div><div class="pure-u-1-4 hidden_mid_and_down"><div id="sidebar"><div class="widget"><form action="//www.google.com/search" method="get" accept-charset="utf-8" target="_blank" class="search-form"><input type="text" name="q" maxlength="20" placeholder="Search"/><input type="hidden" name="sitesearch" value="http://www.lightskystreet.com"/></form></div><div class="widget"><div class="widget-title"><i class="fa fa-folder-o"> Categorías</i></div><ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/Android/">Android</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/Android/Android动画/">Android动画</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Android/MaterialDesign/">MaterialDesign</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Android/优秀项目原理解析/">优秀项目原理解析</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Android/性能优化/">性能优化</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Android/编译/">编译</a></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/Android最佳实践/">Android最佳实践</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/JS/">JS</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/RN/">RN</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Reactive/">Reactive</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Rx/">Rx</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Talk/">Talk</a></li></ul></div><div class="widget"><div class="widget-title"><i class="fa fa-star-o"> Etiquetas</i></div><div class="tagcloud"><a href="/tags/MaterialDesign/" style="font-size: 15px;">MaterialDesign</a> <a href="/tags/Android，性能优化/" style="font-size: 15px;">Android，性能优化</a> <a href="/tags/Android，架构/" style="font-size: 15px;">Android，架构</a> <a href="/tags/Android/" style="font-size: 15px;">Android</a> <a href="/tags/Anim/" style="font-size: 15px;">Anim</a> <a href="/tags/Android，适配/" style="font-size: 15px;">Android，适配</a> <a href="/tags/Android动画/" style="font-size: 15px;">Android动画</a> <a href="/tags/Android，最佳实践/" style="font-size: 15px;">Android，最佳实践</a> <a href="/tags/优秀项目原理解析/" style="font-size: 15px;">优秀项目原理解析</a> <a href="/tags/JS学习笔记/" style="font-size: 15px;">JS学习笔记</a> <a href="/tags/性能优化/" style="font-size: 15px;">性能优化</a> <a href="/tags/Android，编译/" style="font-size: 15px;">Android，编译</a> <a href="/tags/Android，原理解析/" style="font-size: 15px;">Android，原理解析</a> <a href="/tags/Rx/" style="font-size: 15px;">Rx</a> <a href="/tags/PropertyViewAnim/" style="font-size: 15px;">PropertyViewAnim</a> <a href="/tags/RN/" style="font-size: 15px;">RN</a> <a href="/tags/Reactive/" style="font-size: 15px;">Reactive</a> <a href="/tags/Rexactive/" style="font-size: 15px;">Rexactive</a> <a href="/tags/ViewAnim/" style="font-size: 15px;">ViewAnim</a> <a href="/tags/ViewPager/" style="font-size: 15px;">ViewPager</a> <a href="/tags/View绘制机制/" style="font-size: 15px;">View绘制机制</a> <a href="/tags/PropertyAnim，源码分析/" style="font-size: 15px;">PropertyAnim，源码分析</a></div></div><div class="widget"><div class="widget-title"><i class="fa fa-file-o"> Recientes</i></div><ul class="post-list"><li class="post-list-item"><a class="post-list-link" href="/2016/11/11/android-dex-plugin/">multidex与插件化</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/10/19/android-optimize-image-download-size/">Android性能优化-减小图片下载大小</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/10/18/android-optimize-thread/">Android性能优化-线程性能优化</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/10/17/android-optimize-apk/">Android性能优化-减小APK大小</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/10/16/android-optimize-memory/">Android性能优化-内存优化</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/10/16/android-optimize-background/">Android性能优化-App后台优化</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/10/15/android-optimize-start/">Android性能优化-App启动优化</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/06/16/js-str-arr/">JS学习-字符串和数组</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/06/13/js-inherit/">JS学习-封装和继承</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/06/08/js-func/">JS学习-函数</a></li></ul></div><div class="widget"><div class="comments-title"><i class="fa fa-comment-o"> Comentarios recientes</i></div><div data-num-items="5" data-show-avatars="0" data-show-time="1" data-show-admin="0" data-excerpt-length="32" data-show-title="1" class="ds-recent-comments"></div></div></div></div><div class="pure-u-1 pure-u-md-3-4"><div id="footer">© <a href="/." rel="nofollow">lightSky'Blog.</a> Powered by<a rel="nofollow" target="_blank" href="https://hexo.io"> Hexo.</a><a rel="nofollow" target="_blank" href="https://github.com/tufu9441/maupassant-hexo"> Theme</a> by<a rel="nofollow" target="_blank" href="https://github.com/pagecho"> Cho.</a></div></div></div><a id="rocket" href="#top" class="show"></a><script type="text/javascript" src="/js/totop.js?v=0.0.0" async></script><script type="text/javascript" src="//cdn.bootcss.com/fancybox/2.1.5/jquery.fancybox.pack.js" async></script><script type="text/javascript" src="/js/fancybox.js?v=0.0.0" async></script><link rel="stylesheet" type="text/css" href="/css/jquery.fancybox.css?v=0.0.0"><script>var duoshuoQuery = {short_name:'lightSky'};
(function() {
    var ds = document.createElement('script');
    ds.type = 'text/javascript';ds.async = true;
    ds.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') + '//static.duoshuo.com/embed.js';
    ds.charset = 'UTF-8';
    (document.getElementsByTagName('head')[0]
        || document.getElementsByTagName('body')[0]).appendChild(ds);
})();
</script><script>(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
ga('create','UA-57428802-1## Your Google Analytics tracking id, e.g. UA-42425684-2','auto');ga('send','pageview');
</script><script type="text/javascript" src="/js/codeblock-resizer.js?v=0.0.0"></script><script type="text/javascript" src="/js/smartresize.js?v=0.0.0"></script></div></body></html>